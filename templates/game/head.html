{{define "head"}}
<head>
	<title>{{.Title}}</title>
	<meta http-equiv="content-type" 
		content="text/html;charset=utf-8" />

	<link rel="stylesheet" type="text/css" 
		href="/assets/gk/stylesheets/login/login.css" title="default"/>

	<link rel="alternate stylesheet" type="text/css" 
		href="/assets/gk/stylesheets/login/login_thin.css" title="thin"/>
	<link rel="alternate stylesheet" type="text/css" 
		href="/assets/gk/stylesheets/login/login_normal.css" title="normal"/>
	<link rel="alternate stylesheet" type="text/css" 
		href="/assets/gk/stylesheets/login/login_wide.css" title="wide"/>

	<script src="/assets/gk/javascript/dynamiclayout.js" type="text/javascript"></script>
	<script src="/assets/gk/javascript/game/gkRain.js" type="text/javascript"></script>
	<script src="/assets/gk/javascript/game/gkIso.js" type="text/javascript"></script>
	<script src="/assets/gk/javascript/game/gkWs.js" type="text/javascript"></script>
	<script src="/assets/gk/javascript/game/gkAudio.js" type="text/javascript"></script>
	<script src="/assets/gk/javascript/game/gkAvatar.js" type="text/javascript"></script>

	<script type="text/javascript">
		function init() {
			console.log("calling init");

			var s1
			s1 = document.getElementById("selectAvatar");
			s1.selectedIndex = 0;
			s1 = document.getElementById("volume1");
			s1.selectedIndex = 1;
			s1 = document.getElementById("volume2");
			s1.selectedIndex = 1;

			gkWsInit(dispatchWsMessage);

			gkIsoDrawGridDiamond();
			gkRainStart();

			gkAudioInit("/assets/gk/audio");
			var canPlay = document.getElementById("canPlay");
			if (gkAudioContext.canPlayWav) {
				canPlay.innerHTML += " .wav";
			}
			if (gkAudioContext.canPlayMp3) {
				canPlay.innerHTML += " .mp3";
			}
			if (gkAudioContext.canPlayOgg) {
				canPlay.innerHTML += " .ogg";
			}
			gkAudioStartAudio(1, "Devildance");

			gkAvatarInit();

		}

		function dispatchWsMessage(command, jsonData, data) {

			switch (command) {
			case "turnOnRainReq":
				gkRainOn();
				break;
			case "turnOffRainReq":
				gkRainOff();
				break;
			case "getSvgRes":
				var avatar
				field = document.getElementById("gkField");
				gkAvatarRemoveCurrentAvatar();

				console.log("avatarMeta x,y: " + jsonData.origin_x + "," + jsonData.origin_y);

				var svgString = "";
				for (i = 0;i < data.length;i++) {
					svgString += data[i];
				}

				gkAvatarAddNewAvatar(jsonData, svgString);

				break;
			default:
				console.log("did not understand command from game server " + command);
			}
		}

		function doClick(e) {
			var x, y

			x = e.pageX - GK_SVG_MARGIN_X;
			y = e.pageY - GK_SVG_MARGIN_Y;

			var winXY;

			winXY = new GkWinXYDef(x,y);
			gkAvatarSetNewDestination(winXY.convertToIso(0));

			gkAudioStartAudio(2, "duck");
		}

		function changeAvatar() {
			avatarName = document.getElementById("selectAvatar").value;
			console.log("avatarName: " + avatarName)
			//gkWsSendMessage("getSvgReq~{\"SvgName\":\"" + avatarName + "\"}~");
			gkAvatarLoadNewAvatar(avatarName);
		}

		function volumeChange(volumeId) {
			volumeSelect = document.getElementById("volume" + volumeId);
			value = volumeSelect.options[volumeSelect.selectedIndex].value
			gkAudioVolumeChange(volumeId, value);
		}

	</script>
</head>
{{end}}
